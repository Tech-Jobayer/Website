<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>DashBoard - Sub Exchange</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Google Fonts ржерзЗржХрзЗ Noto Sans Bengali ржПржмржВ Hind Siliguri -->
  <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri&family=Noto+Sans+Bengali&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
 
</head>
<body>

  <!-- тЬЕ рж▓рзЛржбрж┐ржВ рж╕рзНржХрзНрж░рж┐ржи -->
<div id="loadingScreen">
  <div class="spinner"></div>
  <div class="loading-text">ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи</div>
</div>

  <!-- тЬЕ ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб ржХржиржЯрзЗржирзНржЯ -->
  <div id="dashboardContent" style="display: none;">
    <div class="header">
      <h2>ЁЯУ║ рж╕рж╛ржмрж╕рзНржХрзНрж░рж┐ржкрж╢ржи ржПржХрзНрж╕ржЪрзЗржЮрзНржЬ ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб</h2>
    </div>

    <div class="profile" id="userArea">
      <button class="btn" onclick="redirectToLogin()">ЁЯФР Login / Signup</button>
    </div>

    <div id="taskList">
      <!-- ржЪрзНржпрж╛ржирзЗрж▓ ржЯрж╛рж╕рзНржХ ржПржЦрж╛ржирзЗ рж▓рзЛржб рж╣ржмрзЗ -->
    </div>
  </div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAC4h55aA0Zz--V5ejyndzR5WC_-9rAPio",
    authDomain: "subscribe-bot-6f9b2.firebaseapp.com",
    databaseURL: "https://subscribe-bot-6f9b2-default-rtdb.firebaseio.com",
    projectId: "subscribe-bot-6f9b2",
    storageBucket: "subscribe-bot-6f9b2.appspot.com",
    messagingSenderId: "141787931031",
    appId: "1:141787931031:web:2108a3e930f5ce4fbc64d2"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  function redirectToLogin() {
    const basePath = window.location.pathname.split('/')[1];
    window.location.href = `${location.origin}/${basePath}/login/`;
  }

  function showUser(user) {
    document.getElementById("userArea").innerHTML = `
      ЁЯСЛ ${user.displayName || user.email} | ЁЯФе <span id="userPoints">Loading...</span> ржкржпрж╝рзЗржирзНржЯ
      <br><button class="btn" onclick="logout()">ЁЯЪк Logout</button>
    `;
    loadPoints(user.uid);
  }

  function logout() {
    auth.signOut().then(() => location.reload());
  }

  function loadPoints(uid) {
    return db.ref('users/' + uid + '/points').once('value').then(snap => {
      const points = snap.val() || 0;
      document.getElementById('userPoints').innerText = points;
    });
  }

  function loadTasks() {
    const list = document.getElementById("taskList");

    return db.ref('channels').once('value').then(snap => {
      const data = snap.val();
      list.innerHTML = '';

      if (!data) {
        list.innerHTML = "<p>ЁЯШв ржХрзЛржирзЛ ржЯрж╛рж╕рзНржХ ржирзЗржЗ</p>";
        return;
      }

      Object.entries(data).forEach(([key, ch]) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${ch.title}</h3>
          <p>рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржмрж╛рж░: ${ch.completed} / ${ch.max}</p>
          <a href="${ch.link}" target="_blank" rel="noopener noreferrer">тЮбя╕П рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржм ржХрж░рждрзЗ ржПржЦрж╛ржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзЛ</a><br><br>
          <button class="btn" onclick="done('${key}')">тЬЕ Done</button>
          <button class="btn" onclick="skip('${key}')">тЭМ Skip</button>
        `;
        list.appendChild(card);
      });
    });
  }

  function done(channelId) {
    const user = auth.currentUser;
    if (!user) return alert("ржжржпрж╝рж╛ ржХрж░рзЗ рж▓ржЧржЗржи ржХрж░рзБржиред");

    const userPointsRef = db.ref('users/' + user.uid + '/points');
    userPointsRef.transaction(current => (current || 0) + 5)
      .then(() => alert("тЬЕ рж╕рж╛ржмрж╕рзНржХрзНрж░рж┐ржкрж╢ржи рж╕ржлрж▓! рзл ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ рж╣ржпрж╝рзЗржЫрзЗред"))
      .catch(() => alert("тЭМ ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗред"));
  }

  function skip(channelId) {
    alert("ржЖржкржирж┐ ржЯрж╛рж╕рзНржХржЯрж┐ ржмрж╛ржж ржжрж┐ржпрж╝рзЗржЫрзЗржиред");
  }

  // ЁЯФД ржкрзЗржЬ рж▓рзЛржбрзЗ рж╕ржм ржХрж┐ржЫрзБ ржкрзНрж░рж╕рзНрждрзБржд рж╣рж▓рзЗ рж▓рзЛржбрж┐ржВ рж╕рзНржХрзНрж░рж┐ржи ржмржирзНржз
  auth.onAuthStateChanged(user => {
    if (user) {
      showUser(user);
      Promise.all([loadPoints(user.uid), loadTasks()]).then(() => {
        document.getElementById("loadingScreen").style.display = "none";
        document.getElementById("dashboardContent").style.display = "block";
      });
    } else {
      document.getElementById("loadingScreen").style.display = "none";
      document.getElementById("dashboardContent").style.display = "block";
      document.getElementById("userArea").innerHTML = `
        <button class="btn" onclick="redirectToLogin()">ЁЯФР Login / Signup</button>
      `;
      document.getElementById("taskList").innerHTML = "<p class="task-message">ЁЯФР ржжржпрж╝рж╛ ржХрж░рзЗ рж▓ржЧржЗржи ржХрж░рзБржи, рждрж╛рж░ржкрж░ ржЯрж╛рж╕рзНржХ ржжрзЗржЦрждрзЗ ржкрж╛рж░ржмрзЗржиред</p>";
    }
  });
</script>
<script>

  // тП│ "ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи..." ржПржирж┐ржорзЗрж╢ржи
  const loadingText = document.querySelector('.loading-text');
  let dotCount = 0;

  setInterval(() => {
    dotCount = (dotCount + 1) % 4;
    const dots = '.'.repeat(dotCount);
    loadingText.innerHTML = `ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи${dots}`;
  }, 500); // ржкрзНрж░рждрж┐ 0.5 рж╕рзЗржХрзЗржирзНржбрзЗ ржкрж░рж┐ржмрж░рзНрждржи рж╣ржмрзЗ
</script>
</body>
</html>